<!DOCTYPE html>
<html>
<head>
    <title>Test Socket Connection</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>Test Socket Connection</h1>
    <div id="status">Connecting...</div>
    <div id="logs"></div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }
        
        // Test connection to signaling server
        const socketUrl = window.location.hostname.includes('vercel.app') ||
                         window.location.hostname.includes('inside-video-call')
                         ? 'https://inside-backend.up.railway.app'
                         : 'http://localhost:3001';

        log('Attempting to connect to ' + socketUrl + '...');

        const socket = io(socketUrl, {
            transports: ['websocket', 'polling'],
            timeout: 5000
        });
        
        socket.on('connect', () => {
            statusDiv.innerHTML = 'âœ… Connected to signaling server!';
            statusDiv.style.color = 'green';
            log('âœ… Connected successfully!');
            log('Socket ID: ' + socket.id);
            
            // Test join room
            socket.emit('join-room', {
                roomId: 'test123',
                userId: 'test-user-' + Date.now(),
                name: 'Test User'
            });
        });
        
        socket.on('connect_error', (error) => {
            statusDiv.innerHTML = 'âŒ Connection failed: ' + error.message;
            statusDiv.style.color = 'red';
            log('âŒ Connection error: ' + error.message);
        });
        
        socket.on('disconnect', (reason) => {
            statusDiv.innerHTML = 'ðŸ”Œ Disconnected: ' + reason;
            statusDiv.style.color = 'orange';
            log('ðŸ”Œ Disconnected: ' + reason);
        });
        
        socket.on('user-joined', (data) => {
            log('ðŸ‘¤ User joined: ' + JSON.stringify(data));
        });
        
        socket.on('user-already-in-room', (data) => {
            log('ðŸ‘¥ User already in room: ' + JSON.stringify(data));
        });
        
        socket.on('signal', (data) => {
            log('ðŸ“¡ Signal received: ' + JSON.stringify(data));
        });
        
        // Test after 2 seconds
        setTimeout(() => {
            if (socket.connected) {
                log('ðŸ§ª Testing signal emission...');
                socket.emit('signal', {
                    roomId: 'test123',
                    signal: { type: 'test', data: 'hello' },
                    userId: 'test-user'
                });
            }
        }, 2000);
    </script>
</body>
</html>
